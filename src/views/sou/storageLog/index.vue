<template>
  <!-- 仓库日志 -->
  <section>
    <section class="mainwrap">
      <SearchList
        :options="searchOptions"
        :data="searchData"
        @on-search="handleSearch"
      />
      <!--表格-->
      <div class="userTable">
        <el-table
          ref="multipleTable"
          v-loading="listLoading"
          element-loading-text="loading"
          element-loading-spinner="el-icon-loading"
          element-loading-background="#fff"
          :data="listData"
          style="width: 100%"
          class="min_table"
          :header-cell-style="{ 'text-align': 'center' }"
          :cell-style="{ 'text-align': 'center' }"
        >
          <el-table-column label="序号" type="index" width="50">
          </el-table-column>
          <el-table-column
            prop="create_time"
            label="操作时间"
            min-width="110"
            sortable
            show-overflow-tooltip
          ></el-table-column>
          <el-table-column
            prop="type"
            label="操作类型"
            min-width="110"
            show-overflow-tooltip
          >
            <template slot-scope="{ row }">
              {{ actionType[row.type] }}
            </template>
          </el-table-column>
          <el-table-column
            prop="book_name"
            label="教材名称"
            min-width="110"
            show-overflow-tooltip
          ></el-table-column>
          <el-table-column
            prop="do_number"
            label="操作数量"
            min-width="110"
            show-overflow-tooltip
          ></el-table-column>
          <el-table-column
            prop="to_storage_name"
            label="目标仓库"
            min-width="110"
            show-overflow-tooltip
          ></el-table-column>
          <el-table-column
            prop="staff_name"
            label="操作人"
            min-width="110"
            show-overflow-tooltip
          ></el-table-column>
          <el-table-column
            prop="common"
            label="备注信息"
            min-width="110"
            show-overflow-tooltip
          ></el-table-column>
        </el-table>
      </div>
    </section>
    <div class="table_bottom">
      <page
        :data="listTotal"
        :curpage="pageNum"
        @pageChange="handlePageChange"
        @pageSizeChange="handleSizeChange"
      />
    </div>
  </section>
</template>

<script>
import { getstoragelog } from "@/api/sou";
import SearchList from "@/components/SearchList/index";
export default {
  name: "certificates",
  components: {
    SearchList,
  },
  data() {
    return {
      listData: [],
      listLoading: false,
      pageNum: 1,
      pageSize: 20,
      listTotal: 0,
      searchData: {
        keyword: "",
        type: -1,
        date: [],
      },
      searchOptions: [
        {
          key: "date",
          type: "datePicker",
          attrs: {
            type: "daterange",
            "range-separator": "至",
            "start-placeholder": "开始日期",
            "end-placeholder": "结束日期",
            "value-format": "yyyy-MM-dd",
          },
        },
        {
          key: "type",
          type: "select",
          options: [
            { label: "全部", value: -1 },
            { label: "入库", value: 0 },
            { label: "调拨出库", value: 1 },
            { label: "调拨入库", value: 2 },
          ],
          attrs: {
            clearable: true,
            placeholder: "操作类型",
          },
        },
        {
          key: "keyword",
          attrs: {
            placeholder: "教材名称/操作人",
          },
        },
      ],
      actionType: {
        0: "入库",
        1: "调拨出库",
        2: "调拨入库",
      },
      addDialog: false,
      currentUid: "",
      previewSrc: "",
      previewDialog: false,
    };
  },
  created() {
    this.getstoragelog();
  },
  methods: {
    handlePreview(src) {
      this.previewDialog = true;
      this.previewSrc = src;
    },

    handleSearch(data) {
      this.pageNum = 1;
      this.searchData = data;
      this.getstoragelog();
    },
    handlePageChange(val) {
      this.pageNum = val;
      this.getstoragelog();
    },
    handleSizeChange(size) {
      this.pageSize = size;
      this.pageNum = 1;
      this.getstoragelog();
    },
    async getstoragelog() {
      const date = this.searchData.date || [];
      const data = {
        storage_id: this.$route.query.id,
        page: this.pageNum,
        limit: this.pageSize,
        keyword: this.searchData.keyword,
        type: this.searchData.type,
        start_time: date[0] || "",
        end_time: date[1] || "",
      };
      this.listLoading = true;
      const res = await getstoragelog(data);
      this.listLoading = false;
      this.listData = res.data.data;
      this.listTotal = res.data.total;
    },
  },
};
</script>

<style lang="scss" scoped>
/deep/.el-table th {
  background: #f8f8f8;
}
</style>
